% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/1.5_function_detection_efficiency_prediction.R
\name{calculate_detection_system}
\alias{calculate_detection_system}
\title{Calculate detection system probabilities and create visualization}
\usage{
calculate_detection_system(
  distance_frame,
  receiver_frame,
  model,
  output_type = "both",
  plots = TRUE
)
}
\arguments{
\item{distance_frame}{Data frame containing distance calculations from
\code{\link{calculate_station_distances}}. Must include columns: cell_id,
x, y, raster_value, cost_distance.}

\item{receiver_frame}{An sf object containing receiver station locations
with x, y coordinates for plotting.}

\item{model}{A fitted model object (e.g., from \code{\link{create_logistic_curve_depth}})
that can predict detection efficiency. Must accept 'dist_m' and 'depth_m'
as predictors.}

\item{output_type}{Character. Type of probabilities to calculate:
\itemize{
\item "cumulative" - Probability of detection by at least one receiver
\item "3_plus" - Probability of detection by 3+ receivers (for positioning)
\item "both" - Calculate both types (default)
}}

\item{plots}{Logical. Whether to create and display visualization plots.
Default is TRUE.}
}
\value{
If plots = TRUE, returns a list containing:
\item{data}{Data frame with spatial coordinates and calculated probabilities}
\item{plots}{List of individual ggplot objects}
\item{combined_plot}{Combined plot using patchwork (if both types calculated)}

If plots = FALSE, returns only the data frame with calculated probabilities.
}
\description{
Computes cumulative detection probabilities and fine-scale positioning
probabilities (3+ receivers) across a spatial area using a detection
efficiency model. Creates heatmap visualizations of detection coverage.
}
\details{
The function performs the following calculations:
\enumerate{
\item Predicts detection efficiency for each cell-receiver pair using the model
\item Calculates cumulative detection probability: 1 - prod(1 - individual_probs)
\item Calculates 3+ receiver probability using exact binomial calculations
\item Creates spatial heatmaps showing detection coverage
}

The cumulative probability represents the likelihood of detecting a signal
anywhere in the system, while the 3+ receiver probability indicates areas
where fine-scale positioning is possible.

The model predictions use 'cost_distance' as 'dist_m' and absolute
'raster_value' as 'depth_m' to match expected model inputs.
}
\examples{
\dontrun{
# Generate receiver stations and calculate distances
stations <- generate_random_points(depth_raster, n_points = 6, seed = 123)
distances <- calculate_station_distances(depth_raster, stations, max_distance = 500)

# Create detection efficiency model
de_model <- create_logistic_curve_depth(
  min_depth = 2, max_depth = 30,
  d50_min_depth = 50, d95_min_depth = 20,
  d50_max_depth = 150, d95_max_depth = 60,
  plot = FALSE
)

# Calculate system detection probabilities
detection_system <- calculate_detection_system(
  distance_frame = distances,
  receiver_frame = stations,
  model = de_model$log_model,
  output_type = "both"
)

# Extract results
detection_data <- detection_system$data
positioning_plot <- detection_system$plots$prob_3_plus

# Calculate only positioning probabilities without plots
positioning_only <- calculate_detection_system(
  distance_frame = distances,
  receiver_frame = stations,
  model = de_model$log_model,
  output_type = "3_plus",
  plots = FALSE
)
}

}
\seealso{
\code{\link{calculate_station_distances}}, \code{\link{create_logistic_curve_depth}}
}
